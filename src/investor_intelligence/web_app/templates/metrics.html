<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Metrics Dashboard - Investor Intelligence</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .metrics-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .metrics-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        
        .metric-card.excellent { border-left-color: #28a745; }
        .metric-card.good { border-left-color: #17a2b8; }
        .metric-card.fair { border-left-color: #ffc107; }
        .metric-card.poor { border-left-color: #dc3545; }
        
        .metric-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 14px;
            color: #666;
        }
        
        .alerts-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .alert-item {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        
        .alert-high { border-left-color: #dc3545; background-color: #f8d7da; }
        .alert-medium { border-left-color: #ffc107; background-color: #fff3cd; }
        .alert-low { border-left-color: #17a2b8; background-color: #d1ecf1; }
        
        .recommendations-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .recommendation-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        
        .rec-high { border-left-color: #dc3545; background-color: #f8d7da; }
        .rec-medium { border-left-color: #ffc107; background-color: #fff3cd; }
        .rec-low { border-left-color: #17a2b8; background-color: #d1ecf1; }
        
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .nav-links {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .nav-links a {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 10px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        
        .nav-links a:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="metrics-container">
        <div class="nav-links">
            <a href="/">Portfolio Dashboard</a>
            <a href="/metrics">Performance Metrics</a>
        </div>
        
        <div class="metrics-header">
            <h1>Performance Metrics Dashboard</h1>
            <p>Real-time monitoring of system performance and latency</p>
        </div>
        
        <!-- Overall Performance Summary -->
        <div class="metrics-grid" id="summary-grid">
            <div class="loading">Loading metrics...</div>
        </div>
        
        <!-- Performance Alerts -->
        <div class="alerts-section">
            <h2>Performance Alerts</h2>
            <div id="alerts-container">
                <div class="loading">Loading alerts...</div>
            </div>
        </div>
        
        <!-- Performance Recommendations -->
        <div class="recommendations-section">
            <h2>Performance Recommendations</h2>
            <div id="recommendations-container">
                <div class="loading">Loading recommendations...</div>
            </div>
        </div>
        
        <!-- Service Performance Chart -->
        <div class="chart-container">
            <h2>Service Performance Overview</h2>
            <canvas id="serviceChart" width="400" height="200"></canvas>
        </div>
        
        <!-- Trend Analysis Chart -->
        <div class="chart-container">
            <h2>Response Time Trends</h2>
            <canvas id="trendChart" width="400" height="200"></canvas>
        </div>
    </div>

    <script>
        // Load metrics data
        async function loadMetrics() {
            try {
                // Load summary
                const summaryResponse = await fetch('/api/metrics/summary');
                const summary = await summaryResponse.json();
                displaySummary(summary);
                
                // Load service metrics
                const servicesResponse = await fetch('/api/metrics/services');
                const services = await servicesResponse.json();
                displayServiceChart(services);
                
                // Load alerts
                const alertsResponse = await fetch('/api/metrics/alerts');
                const alerts = await alertsResponse.json();
                displayAlerts(alerts);
                
                // Load recommendations
                const recommendationsResponse = await fetch('/api/metrics/recommendations');
                const recommendations = await recommendationsResponse.json();
                displayRecommendations(recommendations);
                
                // Load trends
                const trendsResponse = await fetch('/api/metrics/trends');
                const trends = await trendsResponse.json();
                displayTrendChart(trends);
                
            } catch (error) {
                console.error('Error loading metrics:', error);
                document.getElementById('summary-grid').innerHTML = '<div class="error">Error loading metrics data</div>';
            }
        }
        
        function displaySummary(summary) {
            const grid = document.getElementById('summary-grid');
            
            if (summary.error) {
                grid.innerHTML = `<div class="error">${summary.error}</div>`;
                return;
            }
            
            const performanceClass = summary.performance_status || 'unknown';
            
            grid.innerHTML = `
                <div class="metric-card ${performanceClass}">
                    <div class="metric-title">Overall Performance</div>
                    <div class="metric-value">${summary.performance_grade || 'N/A'}</div>
                    <div class="metric-label">Grade (${summary.performance_status || 'Unknown'})</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Average Response Time</div>
                    <div class="metric-value">${summary.avg_duration_ms || 0}ms</div>
                    <div class="metric-label">Last 24 hours</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Success Rate</div>
                    <div class="metric-value">${summary.success_rate || 0}%</div>
                    <div class="metric-label">Successful requests</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Total Requests</div>
                    <div class="metric-value">${summary.total_requests || 0}</div>
                    <div class="metric-label">Last 24 hours</div>
                </div>
            `;
        }
        
        function displayAlerts(alerts) {
            const container = document.getElementById('alerts-container');
            
            if (alerts.error) {
                container.innerHTML = `<div class="error">${alerts.error}</div>`;
                return;
            }
            
            if (alerts.length === 0) {
                container.innerHTML = '<p>No performance alerts at this time.</p>';
                return;
            }
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert-item alert-${alert.severity}">
                    <strong>${alert.type.replace('_', ' ').toUpperCase()}</strong><br>
                    ${alert.message}<br>
                    <small>Service: ${alert.service} | Value: ${alert.value} | Threshold: ${alert.threshold}</small>
                </div>
            `).join('');
        }
        
        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendations-container');
            
            if (recommendations.error) {
                container.innerHTML = `<div class="error">${recommendations.error}</div>`;
                return;
            }
            
            if (recommendations.length === 0) {
                container.innerHTML = '<p>No performance recommendations at this time.</p>';
                return;
            }
            
            container.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item rec-${rec.priority}">
                    <strong>${rec.title}</strong><br>
                    ${rec.description}<br>
                    <small>Priority: ${rec.priority.toUpperCase()}</small>
                    ${rec.suggestions ? `<ul><li>${rec.suggestions.join('</li><li>')}</li></ul>` : ''}
                </div>
            `).join('');
        }
        
        function displayServiceChart(services) {
            const ctx = document.getElementById('serviceChart').getContext('2d');
            
            if (services.error) {
                document.getElementById('serviceChart').parentElement.innerHTML = `<div class="error">${services.error}</div>`;
                return;
            }
            
            const serviceData = services.services || {};
            const labels = Object.keys(serviceData);
            const avgDurations = labels.map(service => serviceData[service].avg_duration_ms || 0);
            const successRates = labels.map(service => serviceData[service].success_rate || 0);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Duration (ms)',
                        data: avgDurations,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Success Rate (%)',
                        data: successRates,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Duration (ms)'
                            }
                        },
                        y1: {
                            position: 'right',
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Success Rate (%)'
                            }
                        }
                    }
                }
            });
        }
        
        function displayTrendChart(trends) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            if (trends.error) {
                document.getElementById('trendChart').parentElement.innerHTML = `<div class="error">${trends.error}</div>`;
                return;
            }
            
            const trendData = trends.trends || {};
            const dates = Object.keys(trends.trends || {}).reverse();
            const avgDurations = dates.map(date => {
                const summary = trendData[date]?.summary;
                return summary?.avg_duration_ms || 0;
            });
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Average Response Time (ms)',
                        data: avgDurations,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Duration (ms)'
                            }
                        }
                    }
                }
            });
        }
        
        // Load metrics on page load
        document.addEventListener('DOMContentLoaded', loadMetrics);
        
        // Refresh metrics every 30 seconds
        setInterval(loadMetrics, 30000);
    </script>
</body>
</html> 